{"version":3,"sources":["index.js"],"names":["Translator","require","ee","cuid","throttle","prettierBytes","match","DefaultStore","getFileType","getFileNameAndExtension","generateFileID","findIndex","supportsUploadProgress","justErrorsLogger","debugLogger","Plugin","RestrictionError","args","isRestriction","Error","AggregateError","message","errors","AggregateRestrictionError","Uppy","opts","defaultLocale","strings","addBulkFilesFailed","youCanOnlyUploadX","youHaveToAtLeastSelectX","missingRequiredMetaField","missingRequiredMetaFieldOnFile","exceedsSize2","exceedsSize","inferiorSize","youCanOnlyUploadFileTypes","noNewAlreadyUploading","noDuplicates","companionError","companionUnauthorizeHint","failedToUpload","noInternetConnection","connectedToInternet","noFilesFound","selectX","selectAllFilesFromFolderNamed","unselectAllFilesFromFolderNamed","selectFileNamed","unselectFileNamed","openFolderNamed","cancel","logOut","filter","resetFilter","loading","authenticateWithTitle","authenticateWith","searchImages","enterTextToSearch","backToSearch","emptyFolderAdded","folderAdded","defaultOptions","id","autoProceed","allowMultipleUploads","debug","restrictions","maxFileSize","minFileSize","maxTotalFileSize","maxNumberOfFiles","minNumberOfFiles","allowedFileTypes","requiredMetaFields","meta","onBeforeFileAdded","currentFile","onBeforeUpload","files","store","logger","infoTimeout","log","constructor","VERSION","Array","isArray","TypeError","i18nInit","plugins","getState","bind","getPlugin","setFileMeta","setFileState","info","hideInfo","addFile","removeFile","pauseResume","validateRestrictions","calculateProgress","leading","trailing","updateOnlineStatus","resetProgress","pauseAll","resumeAll","retryAll","cancelAll","retryUpload","upload","emitter","on","off","once","emit","preProcessors","uploaders","postProcessors","setState","currentUploads","allowNewUpload","capabilities","uploadProgress","individualCancellation","resumableUploads","totalProgress","isHidden","type","recoveredState","storeUnsubscribe","subscribe","prevState","nextState","patch","updateAll","window","addListeners","event","callback","state","iteratePlugins","plugin","update","fileID","translator","locale","i18n","translate","i18nArray","translateArray","setOptions","newOpts","setMeta","defaultProgress","percentage","bytesUploaded","uploadComplete","uploadStarted","updatedFiles","Object","keys","forEach","updatedFile","progress","addPreProcessor","fn","push","removePreProcessor","i","indexOf","splice","addPostProcessor","removePostProcessor","addUploader","removeUploader","data","updatedMeta","newMeta","getFile","getFiles","map","file","checkRestrictions","result","err","reason","length","smart_count","isCorrectFileType","some","replace","extension","toLowerCase","substr","allowedFileTypesString","join","types","size","totalFilesSize","f","backwardsCompat","name","checkMinNumberOfFiles","checkRequiredMetaFields","hasOwnProperty","prototype","fileIDs","call","fileName","showOrLogErrorAndThrow","throwErr","showInformer","details","logMessageWithDetails","assertNewUploadAllowed","checkAndCreateFileStateObject","fileType","onBeforeFileAddedResult","split","fileExtension","isRemote","isGhost","isFinite","newFile","source","bytesTotal","remote","preview","filesArray","startIfAutoProceed","scheduledAutoProceed","setTimeout","catch","stack","addFiles","fileDescriptors","newFiles","subError","removeFiles","updatedUploads","removedFiles","create","fileIsNotRemoved","uploadFileID","undefined","uploadID","newFileIDs","stateUpdate","error","calculateTotalProgress","removedFileIDs","wasPaused","isPaused","inProgressUpdatedFiles","filesToRetry","Promise","resolve","successful","failed","createUpload","forceAllowNewUpload","runUpload","reset","logout","provider","canHavePercentage","Math","round","inProgress","preprocess","postprocess","sizedFiles","unsizedFiles","progressMax","currentProgress","reduce","acc","totalSize","averageSize","uploadedSize","errorHandler","response","errorMsg","newError","Date","now","uploadResp","mode","uploadURL","addEventListener","online","navigator","onLine","wasOffline","getID","use","msg","pluginId","existsPluginAlready","install","foundPlugin","method","pluginType","removePlugin","instance","uninstall","list","slice","index","item","updatedState","close","duration","isComplexMessage","clearTimeout","infoTimeoutID","newInfo","warn","run","restore","removeUpload","reject","step","getUpload","addResultData","currentUpload","uploadData","restoreStep","steps","lastStep","then","updatedUpload","uploader","onBeforeUploadResult","currentlyUploadingFiles","prev","curr","concat","waitingFileIDs","module","exports","core"],"mappings":"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","sourcesContent":["/* global AggregateError */\nconst Translator = require('@uppy/utils/lib/Translator')\nconst ee = require('namespace-emitter')\nconst cuid = require('cuid')\nconst throttle = require('lodash.throttle')\nconst prettierBytes = require('@transloadit/prettier-bytes')\nconst match = require('mime-match')\nconst DefaultStore = require('@uppy/store-default')\nconst getFileType = require('@uppy/utils/lib/getFileType')\nconst getFileNameAndExtension = require('@uppy/utils/lib/getFileNameAndExtension')\nconst generateFileID = require('@uppy/utils/lib/generateFileID')\nconst findIndex = require('@uppy/utils/lib/findIndex')\nconst supportsUploadProgress = require('./supportsUploadProgress')\nconst { justErrorsLogger, debugLogger } = require('./loggers')\nconst Plugin = require('./Plugin')\n\n// Exported from here.\nclass RestrictionError extends Error {\n  constructor (...args) {\n    super(...args)\n    this.isRestriction = true\n  }\n}\nif (typeof AggregateError === 'undefined') {\n  // eslint-disable-next-line no-global-assign\n  AggregateError = class AggregateError extends Error {\n    constructor (message, errors) {\n      super(message)\n      this.errors = errors\n    }\n  }\n}\nclass AggregateRestrictionError extends AggregateError {\n  constructor (...args) {\n    super(...args)\n    this.isRestriction = true\n  }\n}\n\n/**\n * Uppy Core module.\n * Manages plugins, state updates, acts as an event bus,\n * adds/removes files and metadata.\n */\nclass Uppy {\n  // eslint-disable-next-line global-require\n  static VERSION = require('../package.json').version\n\n  /**\n   * Instantiate Uppy\n   *\n   * @param {object} opts — Uppy options\n   */\n  constructor (opts) {\n    this.defaultLocale = {\n      strings: {\n        addBulkFilesFailed: {\n          0: 'Failed to add %{smart_count} file due to an internal error',\n          1: 'Failed to add %{smart_count} files due to internal errors',\n        },\n        youCanOnlyUploadX: {\n          0: 'You can only upload %{smart_count} file',\n          1: 'You can only upload %{smart_count} files',\n        },\n        youHaveToAtLeastSelectX: {\n          0: 'You have to select at least %{smart_count} file',\n          1: 'You have to select at least %{smart_count} files',\n        },\n        missingRequiredMetaField: 'Missing required meta fields',\n        missingRequiredMetaFieldOnFile: 'Missing required meta fields in %{fileName}',\n        // The default `exceedsSize2` string only combines the `exceedsSize` string (%{backwardsCompat}) with the size.\n        // Locales can override `exceedsSize2` to specify a different word order. This is for backwards compat with\n        // Uppy 1.9.x and below which did a naive concatenation of `exceedsSize2 + size` instead of using a locale-specific\n        // substitution.\n        // TODO: In 2.0 `exceedsSize2` should be removed in and `exceedsSize` updated to use substitution.\n        exceedsSize2: '%{backwardsCompat} %{size}',\n        exceedsSize: '%{file} exceeds maximum allowed size of',\n        inferiorSize: 'This file is smaller than the allowed size of %{size}',\n        youCanOnlyUploadFileTypes: 'You can only upload: %{types}',\n        noNewAlreadyUploading: 'Cannot add new files: already uploading',\n        noDuplicates: 'Cannot add the duplicate file \\'%{fileName}\\', it already exists',\n        companionError: 'Connection with Companion failed',\n        companionUnauthorizeHint: 'To unauthorize to your %{provider} account, please go to %{url}',\n        failedToUpload: 'Failed to upload %{file}',\n        noInternetConnection: 'No Internet connection',\n        connectedToInternet: 'Connected to the Internet',\n        // Strings for remote providers\n        noFilesFound: 'You have no files or folders here',\n        selectX: {\n          0: 'Select %{smart_count}',\n          1: 'Select %{smart_count}',\n        },\n        selectAllFilesFromFolderNamed: 'Select all files from folder %{name}',\n        unselectAllFilesFromFolderNamed: 'Unselect all files from folder %{name}',\n        selectFileNamed: 'Select file %{name}',\n        unselectFileNamed: 'Unselect file %{name}',\n        openFolderNamed: 'Open folder %{name}',\n        cancel: 'Cancel',\n        logOut: 'Log out',\n        filter: 'Filter',\n        resetFilter: 'Reset filter',\n        loading: 'Loading...',\n        authenticateWithTitle: 'Please authenticate with %{pluginName} to select files',\n        authenticateWith: 'Connect to %{pluginName}',\n        searchImages: 'Search for images',\n        enterTextToSearch: 'Enter text to search for images',\n        backToSearch: 'Back to Search',\n        emptyFolderAdded: 'No files were added from empty folder',\n        folderAdded: {\n          0: 'Added %{smart_count} file from %{folder}',\n          1: 'Added %{smart_count} files from %{folder}',\n        },\n      },\n    }\n\n    const defaultOptions = {\n      id: 'uppy',\n      autoProceed: false,\n      allowMultipleUploads: true,\n      debug: false,\n      restrictions: {\n        maxFileSize: null,\n        minFileSize: null,\n        maxTotalFileSize: null,\n        maxNumberOfFiles: null,\n        minNumberOfFiles: null,\n        allowedFileTypes: null,\n        requiredMetaFields: [],\n      },\n      meta: {},\n      onBeforeFileAdded: (currentFile) => currentFile,\n      onBeforeUpload: (files) => files,\n      store: DefaultStore(),\n      logger: justErrorsLogger,\n      infoTimeout: 5000,\n    }\n\n    // Merge default options with the ones set by user,\n    // making sure to merge restrictions too\n    this.opts = {\n      ...defaultOptions,\n      ...opts,\n      restrictions: {\n        ...defaultOptions.restrictions,\n        ...(opts && opts.restrictions),\n      },\n    }\n\n    // Support debug: true for backwards-compatability, unless logger is set in opts\n    // opts instead of this.opts to avoid comparing objects — we set logger: justErrorsLogger in defaultOptions\n    if (opts && opts.logger && opts.debug) {\n      this.log('You are using a custom `logger`, but also set `debug: true`, which uses built-in logger to output logs to console. Ignoring `debug: true` and using your custom `logger`.', 'warning')\n    } else if (opts && opts.debug) {\n      this.opts.logger = debugLogger\n    }\n\n    this.log(`Using Core v${this.constructor.VERSION}`)\n\n    if (this.opts.restrictions.allowedFileTypes\n        && this.opts.restrictions.allowedFileTypes !== null\n        && !Array.isArray(this.opts.restrictions.allowedFileTypes)) {\n      throw new TypeError('`restrictions.allowedFileTypes` must be an array')\n    }\n\n    this.i18nInit()\n\n    // Container for different types of plugins\n    this.plugins = {}\n\n    this.getState = this.getState.bind(this)\n    this.getPlugin = this.getPlugin.bind(this)\n    this.setFileMeta = this.setFileMeta.bind(this)\n    this.setFileState = this.setFileState.bind(this)\n    this.log = this.log.bind(this)\n    this.info = this.info.bind(this)\n    this.hideInfo = this.hideInfo.bind(this)\n    this.addFile = this.addFile.bind(this)\n    this.removeFile = this.removeFile.bind(this)\n    this.pauseResume = this.pauseResume.bind(this)\n    this.validateRestrictions = this.validateRestrictions.bind(this)\n\n    // ___Why throttle at 500ms?\n    //    - We must throttle at >250ms for superfocus in Dashboard to work well\n    //    (because animation takes 0.25s, and we want to wait for all animations to be over before refocusing).\n    //    [Practical Check]: if thottle is at 100ms, then if you are uploading a file,\n    //    and click 'ADD MORE FILES', - focus won't activate in Firefox.\n    //    - We must throttle at around >500ms to avoid performance lags.\n    //    [Practical Check] Firefox, try to upload a big file for a prolonged period of time. Laptop will start to heat up.\n    this.calculateProgress = throttle(this.calculateProgress.bind(this), 500, { leading: true, trailing: true })\n\n    this.updateOnlineStatus = this.updateOnlineStatus.bind(this)\n    this.resetProgress = this.resetProgress.bind(this)\n\n    this.pauseAll = this.pauseAll.bind(this)\n    this.resumeAll = this.resumeAll.bind(this)\n    this.retryAll = this.retryAll.bind(this)\n    this.cancelAll = this.cancelAll.bind(this)\n    this.retryUpload = this.retryUpload.bind(this)\n    this.upload = this.upload.bind(this)\n\n    this.emitter = ee()\n    this.on = this.on.bind(this)\n    this.off = this.off.bind(this)\n    this.once = this.emitter.once.bind(this.emitter)\n    this.emit = this.emitter.emit.bind(this.emitter)\n\n    this.preProcessors = []\n    this.uploaders = []\n    this.postProcessors = []\n\n    this.store = this.opts.store\n    this.setState({\n      plugins: {},\n      files: {},\n      currentUploads: {},\n      allowNewUpload: true,\n      capabilities: {\n        uploadProgress: supportsUploadProgress(),\n        individualCancellation: true,\n        resumableUploads: false,\n      },\n      totalProgress: 0,\n      meta: { ...this.opts.meta },\n      info: {\n        isHidden: true,\n        type: 'info',\n        message: '',\n      },\n      recoveredState: null,\n    })\n\n    this.storeUnsubscribe = this.store.subscribe((prevState, nextState, patch) => {\n      this.emit('state-update', prevState, nextState, patch)\n      this.updateAll(nextState)\n    })\n\n    // Exposing uppy object on window for debugging and testing\n    if (this.opts.debug && typeof window !== 'undefined') {\n      window[this.opts.id] = this\n    }\n\n    this.addListeners()\n\n    // Re-enable if we’ll need some capabilities on boot, like isMobileDevice\n    // this._setCapabilities()\n  }\n\n  // _setCapabilities = () => {\n  //   const capabilities = {\n  //     isMobileDevice: isMobileDevice()\n  //   }\n\n  //   this.setState({\n  //     ...this.getState().capabilities,\n  //     capabilities\n  //   })\n  // }\n\n  on (event, callback) {\n    this.emitter.on(event, callback)\n    return this\n  }\n\n  off (event, callback) {\n    this.emitter.off(event, callback)\n    return this\n  }\n\n  /**\n   * Iterate on all plugins and run `update` on them.\n   * Called each time state changes.\n   *\n   */\n  updateAll (state) {\n    this.iteratePlugins(plugin => {\n      plugin.update(state)\n    })\n  }\n\n  /**\n   * Updates state with a patch\n   *\n   * @param {object} patch {foo: 'bar'}\n   */\n  setState (patch) {\n    this.store.setState(patch)\n  }\n\n  /**\n   * Returns current state.\n   *\n   * @returns {object}\n   */\n  getState () {\n    return this.store.getState()\n  }\n\n  /**\n   * Back compat for when uppy.state is used instead of uppy.getState().\n   * @deprecated\n   */\n  get state () {\n    // Here, state is a non-enumerable property.\n    return this.getState()\n  }\n\n  /**\n   * Shorthand to set state for a specific file.\n   */\n  setFileState (fileID, state) {\n    if (!this.getState().files[fileID]) {\n      throw new Error(`Can’t set state for ${fileID} (the file could have been removed)`)\n    }\n\n    this.setState({\n      files: { ...this.getState().files, [fileID]: { ...this.getState().files[fileID], ...state } },\n    })\n  }\n\n  i18nInit () {\n    this.translator = new Translator([this.defaultLocale, this.opts.locale])\n    this.locale = this.translator.locale\n    this.i18n = this.translator.translate.bind(this.translator)\n    this.i18nArray = this.translator.translateArray.bind(this.translator)\n  }\n\n  setOptions (newOpts) {\n    this.opts = {\n      ...this.opts,\n      ...newOpts,\n      restrictions: {\n        ...this.opts.restrictions,\n        ...(newOpts && newOpts.restrictions),\n      },\n    }\n\n    if (newOpts.meta) {\n      this.setMeta(newOpts.meta)\n    }\n\n    this.i18nInit()\n\n    if (newOpts.locale) {\n      this.iteratePlugins((plugin) => {\n        plugin.setOptions()\n      })\n    }\n\n    // Note: this is not the preact `setState`, it's an internal function that has the same name.\n    this.setState() // so that UI re-renders with new options\n  }\n\n  resetProgress () {\n    const defaultProgress = {\n      percentage: 0,\n      bytesUploaded: 0,\n      uploadComplete: false,\n      uploadStarted: null,\n    }\n    const files = { ...this.getState().files }\n    const updatedFiles = {}\n    Object.keys(files).forEach(fileID => {\n      const updatedFile = { ...files[fileID] }\n      updatedFile.progress = { ...updatedFile.progress, ...defaultProgress }\n      updatedFiles[fileID] = updatedFile\n    })\n\n    this.setState({\n      files: updatedFiles,\n      totalProgress: 0,\n    })\n\n    this.emit('reset-progress')\n  }\n\n  addPreProcessor (fn) {\n    this.preProcessors.push(fn)\n  }\n\n  removePreProcessor (fn) {\n    const i = this.preProcessors.indexOf(fn)\n    if (i !== -1) {\n      this.preProcessors.splice(i, 1)\n    }\n  }\n\n  addPostProcessor (fn) {\n    this.postProcessors.push(fn)\n  }\n\n  removePostProcessor (fn) {\n    const i = this.postProcessors.indexOf(fn)\n    if (i !== -1) {\n      this.postProcessors.splice(i, 1)\n    }\n  }\n\n  addUploader (fn) {\n    this.uploaders.push(fn)\n  }\n\n  removeUploader (fn) {\n    const i = this.uploaders.indexOf(fn)\n    if (i !== -1) {\n      this.uploaders.splice(i, 1)\n    }\n  }\n\n  setMeta (data) {\n    const updatedMeta = { ...this.getState().meta, ...data }\n    const updatedFiles = { ...this.getState().files }\n\n    Object.keys(updatedFiles).forEach((fileID) => {\n      updatedFiles[fileID] = { ...updatedFiles[fileID], meta: { ...updatedFiles[fileID].meta, ...data } }\n    })\n\n    this.log('Adding metadata:')\n    this.log(data)\n\n    this.setState({\n      meta: updatedMeta,\n      files: updatedFiles,\n    })\n  }\n\n  setFileMeta (fileID, data) {\n    const updatedFiles = { ...this.getState().files }\n    if (!updatedFiles[fileID]) {\n      this.log('Was trying to set metadata for a file that has been removed: ', fileID)\n      return\n    }\n    const newMeta = { ...updatedFiles[fileID].meta, ...data }\n    updatedFiles[fileID] = { ...updatedFiles[fileID], meta: newMeta }\n    this.setState({ files: updatedFiles })\n  }\n\n  /**\n   * Get a file object.\n   *\n   * @param {string} fileID The ID of the file object to return.\n   */\n  getFile (fileID) {\n    return this.getState().files[fileID]\n  }\n\n  /**\n   * Get all files in an array.\n   */\n  getFiles () {\n    const { files } = this.getState()\n    return Object.keys(files).map((fileID) => files[fileID])\n  }\n\n  /**\n   * A public wrapper for _checkRestrictions — checks if a file passes a set of restrictions.\n   * For use in UI pluigins (like Providers), to disallow selecting files that won’t pass restrictions.\n   *\n   * @param {object} file object to check\n   * @param {Array} [files] array to check maxNumberOfFiles and maxTotalFileSize\n   * @returns {object} { result: true/false, reason: why file didn’t pass restrictions }\n   */\n  validateRestrictions (file, files) {\n    try {\n      this.checkRestrictions(file, files)\n      return {\n        result: true,\n      }\n    } catch (err) {\n      return {\n        result: false,\n        reason: err.message,\n      }\n    }\n  }\n\n  /**\n   * Check if file passes a set of restrictions set in options: maxFileSize, minFileSize,\n   * maxNumberOfFiles and allowedFileTypes.\n   *\n   * @param {object} file object to check\n   * @param {Array} [files] array to check maxNumberOfFiles and maxTotalFileSize\n   * @private\n   */\n  checkRestrictions (file, files = this.getFiles()) {\n    const { maxFileSize, minFileSize, maxTotalFileSize, maxNumberOfFiles, allowedFileTypes } = this.opts.restrictions\n\n    if (maxNumberOfFiles) {\n      if (files.length + 1 > maxNumberOfFiles) {\n        throw new RestrictionError(`${this.i18n('youCanOnlyUploadX', { smart_count: maxNumberOfFiles })}`)\n      }\n    }\n\n    if (allowedFileTypes) {\n      const isCorrectFileType = allowedFileTypes.some((type) => {\n        // check if this is a mime-type\n        if (type.indexOf('/') > -1) {\n          if (!file.type) return false\n          return match(file.type.replace(/;.*?$/, ''), type)\n        }\n\n        // otherwise this is likely an extension\n        if (type[0] === '.' && file.extension) {\n          return file.extension.toLowerCase() === type.substr(1).toLowerCase()\n        }\n        return false\n      })\n\n      if (!isCorrectFileType) {\n        const allowedFileTypesString = allowedFileTypes.join(', ')\n        throw new RestrictionError(this.i18n('youCanOnlyUploadFileTypes', { types: allowedFileTypesString }))\n      }\n    }\n\n    // We can't check maxTotalFileSize if the size is unknown.\n    if (maxTotalFileSize && file.size != null) {\n      let totalFilesSize = 0\n      totalFilesSize += file.size\n      files.forEach((f) => {\n        totalFilesSize += f.size\n      })\n      if (totalFilesSize > maxTotalFileSize) {\n        throw new RestrictionError(this.i18n('exceedsSize2', {\n          backwardsCompat: this.i18n('exceedsSize'),\n          size: prettierBytes(maxTotalFileSize),\n          file: file.name,\n        }))\n      }\n    }\n\n    // We can't check maxFileSize if the size is unknown.\n    if (maxFileSize && file.size != null) {\n      if (file.size > maxFileSize) {\n        throw new RestrictionError(this.i18n('exceedsSize2', {\n          backwardsCompat: this.i18n('exceedsSize'),\n          size: prettierBytes(maxFileSize),\n          file: file.name,\n        }))\n      }\n    }\n\n    // We can't check minFileSize if the size is unknown.\n    if (minFileSize && file.size != null) {\n      if (file.size < minFileSize) {\n        throw new RestrictionError(this.i18n('inferiorSize', {\n          size: prettierBytes(minFileSize),\n        }))\n      }\n    }\n  }\n\n  /**\n   * Check if minNumberOfFiles restriction is reached before uploading.\n   *\n   * @private\n   */\n  checkMinNumberOfFiles (files) {\n    const { minNumberOfFiles } = this.opts.restrictions\n    if (Object.keys(files).length < minNumberOfFiles) {\n      throw new RestrictionError(`${this.i18n('youHaveToAtLeastSelectX', { smart_count: minNumberOfFiles })}`)\n    }\n  }\n\n  /**\n   * Check if requiredMetaField restriction is met before uploading.\n   *\n   * @private\n   */\n  checkRequiredMetaFields (files) {\n    const { requiredMetaFields } = this.opts.restrictions\n    const { hasOwnProperty } = Object.prototype\n\n    const errors = []\n    const fileIDs = Object.keys(files)\n    for (let i = 0; i < fileIDs.length; i++) {\n      const file = this.getFile(fileIDs[i])\n      for (let i = 0; i < requiredMetaFields.length; i++) {\n        if (!hasOwnProperty.call(file.meta, requiredMetaFields[i]) || file.meta[requiredMetaFields[i]] === '') {\n          const err = new RestrictionError(`${this.i18n('missingRequiredMetaFieldOnFile', { fileName: file.name })}`)\n          errors.push(err)\n          this.showOrLogErrorAndThrow(err, { file, throwErr: false })\n        }\n      }\n    }\n\n    if (errors.length) {\n      throw new AggregateRestrictionError(`${this.i18n('missingRequiredMetaField')}`, errors)\n    }\n  }\n\n  /**\n   * Logs an error, sets Informer message, then throws the error.\n   * Emits a 'restriction-failed' event if it’s a restriction error\n   *\n   * @param {object | string} err — Error object or plain string message\n   * @param {object} [options]\n   * @param {boolean} [options.showInformer=true] — Sometimes developer might want to show Informer manually\n   * @param {object} [options.file=null] — File object used to emit the restriction error\n   * @param {boolean} [options.throwErr=true] — Errors shouldn’t be thrown, for example, in `upload-error` event\n   * @private\n   */\n  showOrLogErrorAndThrow (err, { showInformer = true, file = null, throwErr = true } = {}) {\n    const message = typeof err === 'object' ? err.message : err\n    const details = (typeof err === 'object' && err.details) ? err.details : ''\n\n    // Restriction errors should be logged, but not as errors,\n    // as they are expected and shown in the UI.\n    let logMessageWithDetails = message\n    if (details) {\n      logMessageWithDetails += ` ${details}`\n    }\n    if (err.isRestriction) {\n      this.log(logMessageWithDetails)\n      this.emit('restriction-failed', file, err)\n    } else {\n      this.log(logMessageWithDetails, 'error')\n    }\n\n    // Sometimes informer has to be shown manually by the developer,\n    // for example, in `onBeforeFileAdded`.\n    if (showInformer) {\n      this.info({ message, details }, 'error', this.opts.infoTimeout)\n    }\n\n    if (throwErr) {\n      throw (typeof err === 'object' ? err : new Error(err))\n    }\n  }\n\n  assertNewUploadAllowed (file) {\n    const { allowNewUpload } = this.getState()\n\n    if (allowNewUpload === false) {\n      this.showOrLogErrorAndThrow(new RestrictionError(this.i18n('noNewAlreadyUploading')), { file })\n    }\n  }\n\n  /**\n   * Create a file state object based on user-provided `addFile()` options.\n   *\n   * Note this is extremely side-effectful and should only be done when a file state object will be added to state immediately afterward!\n   *\n   * The `files` value is passed in because it may be updated by the caller without updating the store.\n   */\n  checkAndCreateFileStateObject (files, f) {\n    const fileType = getFileType(f)\n    let file = f\n    file.type = fileType\n\n    const onBeforeFileAddedResult = this.opts.onBeforeFileAdded(file, files)\n\n    if (onBeforeFileAddedResult === false) {\n      // Don’t show UI info for this error, as it should be done by the developer\n      this.showOrLogErrorAndThrow(new RestrictionError('Cannot add the file because onBeforeFileAdded returned false.'), { showInformer: false, file })\n    }\n\n    if (typeof onBeforeFileAddedResult === 'object' && onBeforeFileAddedResult) {\n      file = onBeforeFileAddedResult\n    }\n\n    let fileName\n    if (file.name) {\n      fileName = file.name\n    } else if (fileType.split('/')[0] === 'image') {\n      fileName = `${fileType.split('/')[0]}.${fileType.split('/')[1]}`\n    } else {\n      fileName = 'noname'\n    }\n    const fileExtension = getFileNameAndExtension(fileName).extension\n    const isRemote = file.isRemote || false\n\n    const fileID = generateFileID(file)\n\n    if (files[fileID] && !files[fileID].isGhost) {\n      this.showOrLogErrorAndThrow(new RestrictionError(this.i18n('noDuplicates', { fileName })), { file })\n    }\n\n    const meta = file.meta || {}\n    meta.name = fileName\n    meta.type = fileType\n\n    // `null` means the size is unknown.\n    const size = isFinite(file.data.size) ? file.data.size : null\n    const newFile = {\n      source: file.source || '',\n      id: fileID,\n      name: fileName,\n      extension: fileExtension || '',\n      meta: {\n        ...this.getState().meta,\n        ...meta,\n      },\n      type: fileType,\n      data: file.data,\n      progress: {\n        percentage: 0,\n        bytesUploaded: 0,\n        bytesTotal: size,\n        uploadComplete: false,\n        uploadStarted: null,\n      },\n      size,\n      isRemote,\n      remote: file.remote || '',\n      preview: file.preview,\n    }\n\n    try {\n      const filesArray = Object.keys(files).map(i => files[i])\n      this.checkRestrictions(newFile, filesArray)\n    } catch (err) {\n      this.showOrLogErrorAndThrow(err, { file: newFile })\n    }\n\n    return newFile\n  }\n\n  // Schedule an upload if `autoProceed` is enabled.\n  startIfAutoProceed () {\n    if (this.opts.autoProceed && !this.scheduledAutoProceed) {\n      this.scheduledAutoProceed = setTimeout(() => {\n        this.scheduledAutoProceed = null\n        this.upload().catch((err) => {\n          if (!err.isRestriction) {\n            this.log(err.stack || err.message || err)\n          }\n        })\n      }, 4)\n    }\n  }\n\n  /**\n   * Add a new file to `state.files`. This will run `onBeforeFileAdded`,\n   * try to guess file type in a clever way, check file against restrictions,\n   * and start an upload if `autoProceed === true`.\n   *\n   * @param {object} file object to add\n   * @returns {string} id for the added file\n   */\n  addFile (file) {\n    this.assertNewUploadAllowed(file)\n\n    const { files } = this.getState()\n    let newFile = this.checkAndCreateFileStateObject(files, file)\n\n    // Users are asked to re-select recovered files without data,\n    // and to keep the progress, meta and everthing else, we only replace said data\n    if (files[newFile.id] && files[newFile.id].isGhost) {\n      newFile = {\n        ...files[newFile.id],\n        data: file.data,\n        isGhost: false,\n      }\n      this.log(`Replaced the blob in the restored ghost file: ${newFile.name}, ${newFile.id}`)\n    }\n\n    this.setState({\n      files: {\n        ...files,\n        [newFile.id]: newFile,\n      },\n    })\n\n    this.emit('file-added', newFile)\n    this.emit('files-added', [newFile])\n    this.log(`Added file: ${newFile.name}, ${newFile.id}, mime type: ${newFile.type}`)\n\n    this.startIfAutoProceed()\n\n    return newFile.id\n  }\n\n  /**\n   * Add multiple files to `state.files`. See the `addFile()` documentation.\n   *\n   * If an error occurs while adding a file, it is logged and the user is notified.\n   * This is good for UI plugins, but not for programmatic use.\n   * Programmatic users should usually still use `addFile()` on individual files.\n   */\n  addFiles (fileDescriptors) {\n    this.assertNewUploadAllowed()\n\n    // create a copy of the files object only once\n    const files = { ...this.getState().files }\n    const newFiles = []\n    const errors = []\n    for (let i = 0; i < fileDescriptors.length; i++) {\n      try {\n        let newFile = this.checkAndCreateFileStateObject(files, fileDescriptors[i])\n        // Users are asked to re-select recovered files without data,\n        // and to keep the progress, meta and everthing else, we only replace said data\n        if (files[newFile.id] && files[newFile.id].isGhost) {\n          newFile = {\n            ...files[newFile.id],\n            data: fileDescriptors[i].data,\n            isGhost: false,\n          }\n          this.log(`Replaced blob in a ghost file: ${newFile.name}, ${newFile.id}`)\n        }\n        files[newFile.id] = newFile\n        newFiles.push(newFile)\n      } catch (err) {\n        if (!err.isRestriction) {\n          errors.push(err)\n        }\n      }\n    }\n\n    this.setState({ files })\n\n    newFiles.forEach((newFile) => {\n      this.emit('file-added', newFile)\n    })\n\n    this.emit('files-added', newFiles)\n\n    if (newFiles.length > 5) {\n      this.log(`Added batch of ${newFiles.length} files`)\n    } else {\n      Object.keys(newFiles).forEach(fileID => {\n        this.log(`Added file: ${newFiles[fileID].name}\\n id: ${newFiles[fileID].id}\\n type: ${newFiles[fileID].type}`)\n      })\n    }\n\n    if (newFiles.length > 0) {\n      this.startIfAutoProceed()\n    }\n\n    if (errors.length > 0) {\n      let message = 'Multiple errors occurred while adding files:\\n'\n      errors.forEach((subError) => {\n        message += `\\n * ${subError.message}`\n      })\n\n      this.info({\n        message: this.i18n('addBulkFilesFailed', { smart_count: errors.length }),\n        details: message,\n      }, 'error', this.opts.infoTimeout)\n\n      if (typeof AggregateError === 'function') {\n        throw new AggregateError(errors, message)\n      } else {\n        const err = new Error(message)\n        err.errors = errors\n        throw err\n      }\n    }\n  }\n\n  removeFiles (fileIDs, reason) {\n    const { files, currentUploads } = this.getState()\n    const updatedFiles = { ...files }\n    const updatedUploads = { ...currentUploads }\n\n    const removedFiles = Object.create(null)\n    fileIDs.forEach((fileID) => {\n      if (files[fileID]) {\n        removedFiles[fileID] = files[fileID]\n        delete updatedFiles[fileID]\n      }\n    })\n\n    // Remove files from the `fileIDs` list in each upload.\n    function fileIsNotRemoved (uploadFileID) {\n      return removedFiles[uploadFileID] === undefined\n    }\n\n    Object.keys(updatedUploads).forEach((uploadID) => {\n      const newFileIDs = currentUploads[uploadID].fileIDs.filter(fileIsNotRemoved)\n\n      // Remove the upload if no files are associated with it anymore.\n      if (newFileIDs.length === 0) {\n        delete updatedUploads[uploadID]\n        return\n      }\n\n      updatedUploads[uploadID] = {\n        ...currentUploads[uploadID],\n        fileIDs: newFileIDs,\n      }\n    })\n\n    const stateUpdate = {\n      currentUploads: updatedUploads,\n      files: updatedFiles,\n    }\n\n    // If all files were removed - allow new uploads,\n    // and clear recoveredState\n    if (Object.keys(updatedFiles).length === 0) {\n      stateUpdate.allowNewUpload = true\n      stateUpdate.error = null\n      stateUpdate.recoveredState = null\n    }\n\n    this.setState(stateUpdate)\n    this.calculateTotalProgress()\n\n    const removedFileIDs = Object.keys(removedFiles)\n    removedFileIDs.forEach((fileID) => {\n      this.emit('file-removed', removedFiles[fileID], reason)\n    })\n\n    if (removedFileIDs.length > 5) {\n      this.log(`Removed ${removedFileIDs.length} files`)\n    } else {\n      this.log(`Removed files: ${removedFileIDs.join(', ')}`)\n    }\n  }\n\n  removeFile (fileID, reason = null) {\n    this.removeFiles([fileID], reason)\n  }\n\n  pauseResume (fileID) {\n    if (!this.getState().capabilities.resumableUploads\n         || this.getFile(fileID).uploadComplete) {\n      return undefined\n    }\n\n    const wasPaused = this.getFile(fileID).isPaused || false\n    const isPaused = !wasPaused\n\n    this.setFileState(fileID, {\n      isPaused,\n    })\n\n    this.emit('upload-pause', fileID, isPaused)\n\n    return isPaused\n  }\n\n  pauseAll () {\n    const updatedFiles = { ...this.getState().files }\n    const inProgressUpdatedFiles = Object.keys(updatedFiles).filter((file) => {\n      return !updatedFiles[file].progress.uploadComplete\n             && updatedFiles[file].progress.uploadStarted\n    })\n\n    inProgressUpdatedFiles.forEach((file) => {\n      const updatedFile = { ...updatedFiles[file], isPaused: true }\n      updatedFiles[file] = updatedFile\n    })\n\n    this.setState({ files: updatedFiles })\n    this.emit('pause-all')\n  }\n\n  resumeAll () {\n    const updatedFiles = { ...this.getState().files }\n    const inProgressUpdatedFiles = Object.keys(updatedFiles).filter((file) => {\n      return !updatedFiles[file].progress.uploadComplete\n             && updatedFiles[file].progress.uploadStarted\n    })\n\n    inProgressUpdatedFiles.forEach((file) => {\n      const updatedFile = {\n        ...updatedFiles[file],\n        isPaused: false,\n        error: null,\n      }\n      updatedFiles[file] = updatedFile\n    })\n    this.setState({ files: updatedFiles })\n\n    this.emit('resume-all')\n  }\n\n  retryAll () {\n    const updatedFiles = { ...this.getState().files }\n    const filesToRetry = Object.keys(updatedFiles).filter(file => {\n      return updatedFiles[file].error\n    })\n\n    filesToRetry.forEach((file) => {\n      const updatedFile = {\n        ...updatedFiles[file],\n        isPaused: false,\n        error: null,\n      }\n      updatedFiles[file] = updatedFile\n    })\n    this.setState({\n      files: updatedFiles,\n      error: null,\n    })\n\n    this.emit('retry-all', filesToRetry)\n\n    if (filesToRetry.length === 0) {\n      return Promise.resolve({\n        successful: [],\n        failed: [],\n      })\n    }\n\n    const uploadID = this.createUpload(filesToRetry, {\n      forceAllowNewUpload: true, // create new upload even if allowNewUpload: false\n    })\n    return this.runUpload(uploadID)\n  }\n\n  cancelAll () {\n    this.emit('cancel-all')\n\n    const { files } = this.getState()\n\n    const fileIDs = Object.keys(files)\n    if (fileIDs.length) {\n      this.removeFiles(fileIDs, 'cancel-all')\n    }\n\n    this.setState({\n      totalProgress: 0,\n      error: null,\n      recoveredState: null,\n    })\n  }\n\n  retryUpload (fileID) {\n    this.setFileState(fileID, {\n      error: null,\n      isPaused: false,\n    })\n\n    this.emit('upload-retry', fileID)\n\n    const uploadID = this.createUpload([fileID], {\n      forceAllowNewUpload: true, // create new upload even if allowNewUpload: false\n    })\n    return this.runUpload(uploadID)\n  }\n\n  reset () {\n    this.cancelAll()\n  }\n\n  logout () {\n    this.iteratePlugins(plugin => {\n      if (plugin.provider && plugin.provider.logout) {\n        plugin.provider.logout()\n      }\n    })\n  }\n\n  calculateProgress (file, data) {\n    if (!this.getFile(file.id)) {\n      this.log(`Not setting progress for a file that has been removed: ${file.id}`)\n      return\n    }\n\n    // bytesTotal may be null or zero; in that case we can't divide by it\n    const canHavePercentage = isFinite(data.bytesTotal) && data.bytesTotal > 0\n    this.setFileState(file.id, {\n      progress: {\n        ...this.getFile(file.id).progress,\n        bytesUploaded: data.bytesUploaded,\n        bytesTotal: data.bytesTotal,\n        percentage: canHavePercentage\n          // TODO(goto-bus-stop) flooring this should probably be the choice of the UI?\n          // we get more accurate calculations if we don't round this at all.\n          ? Math.round((data.bytesUploaded / data.bytesTotal) * 100)\n          : 0,\n      },\n    })\n\n    this.calculateTotalProgress()\n  }\n\n  calculateTotalProgress () {\n    // calculate total progress, using the number of files currently uploading,\n    // multiplied by 100 and the summ of individual progress of each file\n    const files = this.getFiles()\n\n    const inProgress = files.filter((file) => {\n      return file.progress.uploadStarted\n        || file.progress.preprocess\n        || file.progress.postprocess\n    })\n\n    if (inProgress.length === 0) {\n      this.emit('progress', 0)\n      this.setState({ totalProgress: 0 })\n      return\n    }\n\n    const sizedFiles = inProgress.filter((file) => file.progress.bytesTotal != null)\n    const unsizedFiles = inProgress.filter((file) => file.progress.bytesTotal == null)\n\n    if (sizedFiles.length === 0) {\n      const progressMax = inProgress.length * 100\n      const currentProgress = unsizedFiles.reduce((acc, file) => {\n        return acc + file.progress.percentage\n      }, 0)\n      const totalProgress = Math.round((currentProgress / progressMax) * 100)\n      this.setState({ totalProgress })\n      return\n    }\n\n    let totalSize = sizedFiles.reduce((acc, file) => {\n      return acc + file.progress.bytesTotal\n    }, 0)\n    const averageSize = totalSize / sizedFiles.length\n    totalSize += averageSize * unsizedFiles.length\n\n    let uploadedSize = 0\n    sizedFiles.forEach((file) => {\n      uploadedSize += file.progress.bytesUploaded\n    })\n    unsizedFiles.forEach((file) => {\n      uploadedSize += (averageSize * (file.progress.percentage || 0)) / 100\n    })\n\n    let totalProgress = totalSize === 0\n      ? 0\n      : Math.round((uploadedSize / totalSize) * 100)\n\n    // hot fix, because:\n    // uploadedSize ended up larger than totalSize, resulting in 1325% total\n    if (totalProgress > 100) {\n      totalProgress = 100\n    }\n\n    this.setState({ totalProgress })\n    this.emit('progress', totalProgress)\n  }\n\n  /**\n   * Registers listeners for all global actions, like:\n   * `error`, `file-removed`, `upload-progress`\n   */\n  addListeners () {\n    /**\n     * @param {Error} error\n     * @param {object} [file]\n     * @param {object} [response]\n     */\n    const errorHandler = (error, file, response) => {\n      let errorMsg = error.message || 'Unknown error'\n      if (error.details) {\n        errorMsg += ` ${error.details}`\n      }\n\n      this.setState({ error: errorMsg })\n\n      // When a file is also given, we store the error on the file object.\n      if (file != null && typeof file.id === 'string') {\n        this.setFileState(file.id, {\n          error: errorMsg,\n          response,\n        })\n      }\n    }\n\n    this.on('error', errorHandler)\n\n    this.on('upload-error', (file, error, response) => {\n      errorHandler(error, file, response)\n\n      if (typeof error === 'object' && error.message) {\n        const newError = new Error(error.message)\n        newError.details = error.message\n        if (error.details) {\n          newError.details += ` ${error.details}`\n        }\n        newError.message = this.i18n('failedToUpload', { file: file.name })\n        this.showOrLogErrorAndThrow(newError, {\n          throwErr: false,\n        })\n      } else {\n        this.showOrLogErrorAndThrow(error, {\n          throwErr: false,\n        })\n      }\n    })\n\n    this.on('upload', () => {\n      this.setState({ error: null })\n    })\n\n    this.on('upload-started', (file) => {\n      if (!this.getFile(file.id)) {\n        this.log(`Not setting progress for a file that has been removed: ${file.id}`)\n        return\n      }\n      this.setFileState(file.id, {\n        progress: {\n          uploadStarted: Date.now(),\n          uploadComplete: false,\n          percentage: 0,\n          bytesUploaded: 0,\n          bytesTotal: file.size,\n        },\n      })\n    })\n\n    this.on('upload-progress', this.calculateProgress)\n\n    this.on('upload-success', (file, uploadResp) => {\n      if (!this.getFile(file.id)) {\n        this.log(`Not setting progress for a file that has been removed: ${file.id}`)\n        return\n      }\n\n      const currentProgress = this.getFile(file.id).progress\n      this.setFileState(file.id, {\n        progress: {\n          ...currentProgress,\n          postprocess: this.postProcessors.length > 0 ? {\n            mode: 'indeterminate',\n          } : null,\n          uploadComplete: true,\n          percentage: 100,\n          bytesUploaded: currentProgress.bytesTotal,\n        },\n        response: uploadResp,\n        uploadURL: uploadResp.uploadURL,\n        isPaused: false,\n      })\n\n      // Remote providers sometimes don't tell us the file size,\n      // but we can know how many bytes we uploaded once the upload is complete.\n      if (file.size == null) {\n        this.setFileState(file.id, {\n          size: uploadResp.bytesUploaded || currentProgress.bytesTotal,\n        })\n      }\n\n      this.calculateTotalProgress()\n    })\n\n    this.on('preprocess-progress', (file, progress) => {\n      if (!this.getFile(file.id)) {\n        this.log(`Not setting progress for a file that has been removed: ${file.id}`)\n        return\n      }\n      this.setFileState(file.id, {\n        progress: { ...this.getFile(file.id).progress, preprocess: progress },\n      })\n    })\n\n    this.on('preprocess-complete', (file) => {\n      if (!this.getFile(file.id)) {\n        this.log(`Not setting progress for a file that has been removed: ${file.id}`)\n        return\n      }\n      const files = { ...this.getState().files }\n      files[file.id] = { ...files[file.id], progress: { ...files[file.id].progress } }\n      delete files[file.id].progress.preprocess\n\n      this.setState({ files })\n    })\n\n    this.on('postprocess-progress', (file, progress) => {\n      if (!this.getFile(file.id)) {\n        this.log(`Not setting progress for a file that has been removed: ${file.id}`)\n        return\n      }\n      this.setFileState(file.id, {\n        progress: { ...this.getState().files[file.id].progress, postprocess: progress },\n      })\n    })\n\n    this.on('postprocess-complete', (file) => {\n      if (!this.getFile(file.id)) {\n        this.log(`Not setting progress for a file that has been removed: ${file.id}`)\n        return\n      }\n      const files = {\n        ...this.getState().files,\n      }\n      files[file.id] = {\n        ...files[file.id],\n        progress: {\n          ...files[file.id].progress,\n        },\n      }\n      delete files[file.id].progress.postprocess\n      // TODO should we set some kind of `fullyComplete` property on the file object\n      // so it's easier to see that the file is upload…fully complete…rather than\n      // what we have to do now (`uploadComplete && !postprocess`)\n\n      this.setState({ files })\n    })\n\n    this.on('restored', () => {\n      // Files may have changed--ensure progress is still accurate.\n      this.calculateTotalProgress()\n    })\n\n    // show informer if offline\n    if (typeof window !== 'undefined' && window.addEventListener) {\n      window.addEventListener('online', () => this.updateOnlineStatus())\n      window.addEventListener('offline', () => this.updateOnlineStatus())\n      setTimeout(() => this.updateOnlineStatus(), 3000)\n    }\n  }\n\n  updateOnlineStatus () {\n    const online\n      = typeof window.navigator.onLine !== 'undefined'\n        ? window.navigator.onLine\n        : true\n    if (!online) {\n      this.emit('is-offline')\n      this.info(this.i18n('noInternetConnection'), 'error', 0)\n      this.wasOffline = true\n    } else {\n      this.emit('is-online')\n      if (this.wasOffline) {\n        this.emit('back-online')\n        this.info(this.i18n('connectedToInternet'), 'success', 3000)\n        this.wasOffline = false\n      }\n    }\n  }\n\n  getID () {\n    return this.opts.id\n  }\n\n  /**\n   * Registers a plugin with Core.\n   *\n   * @param {object} Plugin object\n   * @param {object} [opts] object with options to be passed to Plugin\n   * @returns {object} self for chaining\n   */\n  // eslint-disable-next-line no-shadow\n  use (Plugin, opts) {\n    if (typeof Plugin !== 'function') {\n      const msg = `Expected a plugin class, but got ${Plugin === null ? 'null' : typeof Plugin}.`\n        + ' Please verify that the plugin was imported and spelled correctly.'\n      throw new TypeError(msg)\n    }\n\n    // Instantiate\n    const plugin = new Plugin(this, opts)\n    const pluginId = plugin.id\n    this.plugins[plugin.type] = this.plugins[plugin.type] || []\n\n    if (!pluginId) {\n      throw new Error('Your plugin must have an id')\n    }\n\n    if (!plugin.type) {\n      throw new Error('Your plugin must have a type')\n    }\n\n    const existsPluginAlready = this.getPlugin(pluginId)\n    if (existsPluginAlready) {\n      const msg = `Already found a plugin named '${existsPluginAlready.id}'. `\n        + `Tried to use: '${pluginId}'.\\n`\n        + 'Uppy plugins must have unique `id` options. See https://uppy.io/docs/plugins/#id.'\n      throw new Error(msg)\n    }\n\n    if (Plugin.VERSION) {\n      this.log(`Using ${pluginId} v${Plugin.VERSION}`)\n    }\n\n    this.plugins[plugin.type].push(plugin)\n    plugin.install()\n\n    return this\n  }\n\n  /**\n   * Find one Plugin by name.\n   *\n   * @param {string} id plugin id\n   * @returns {object|boolean}\n   */\n  getPlugin (id) {\n    let foundPlugin = null\n    this.iteratePlugins((plugin) => {\n      if (plugin.id === id) {\n        foundPlugin = plugin\n        return false\n      }\n    })\n    return foundPlugin\n  }\n\n  /**\n   * Iterate through all `use`d plugins.\n   *\n   * @param {Function} method that will be run on each plugin\n   */\n  iteratePlugins (method) {\n    Object.keys(this.plugins).forEach(pluginType => {\n      this.plugins[pluginType].forEach(method)\n    })\n  }\n\n  /**\n   * Uninstall and remove a plugin.\n   *\n   * @param {object} instance The plugin instance to remove.\n   */\n  removePlugin (instance) {\n    this.log(`Removing plugin ${instance.id}`)\n    this.emit('plugin-remove', instance)\n\n    if (instance.uninstall) {\n      instance.uninstall()\n    }\n\n    const list = this.plugins[instance.type].slice()\n    // list.indexOf failed here, because Vue3 converted the plugin instance\n    // to a Proxy object, which failed the strict comparison test:\n    // obj !== objProxy\n    const index = findIndex(list, item => item.id === instance.id)\n    if (index !== -1) {\n      list.splice(index, 1)\n      this.plugins[instance.type] = list\n    }\n\n    const state = this.getState()\n    const updatedState = {\n      plugins: {\n        ...state.plugins,\n        [instance.id]: undefined,\n      },\n    }\n    this.setState(updatedState)\n  }\n\n  /**\n   * Uninstall all plugins and close down this Uppy instance.\n   */\n  close () {\n    this.log(`Closing Uppy instance ${this.opts.id}: removing all files and uninstalling plugins`)\n\n    this.reset()\n\n    this.storeUnsubscribe()\n\n    this.iteratePlugins((plugin) => {\n      this.removePlugin(plugin)\n    })\n  }\n\n  /**\n   * Set info message in `state.info`, so that UI plugins like `Informer`\n   * can display the message.\n   *\n   * @param {string | object} message Message to be displayed by the informer\n   * @param {string} [type]\n   * @param {number} [duration]\n   */\n\n  info (message, type = 'info', duration = 3000) {\n    const isComplexMessage = typeof message === 'object'\n\n    this.setState({\n      info: {\n        isHidden: false,\n        type,\n        message: isComplexMessage ? message.message : message,\n        details: isComplexMessage ? message.details : null,\n      },\n    })\n\n    this.emit('info-visible')\n\n    clearTimeout(this.infoTimeoutID)\n    if (duration === 0) {\n      this.infoTimeoutID = undefined\n      return\n    }\n\n    // hide the informer after `duration` milliseconds\n    this.infoTimeoutID = setTimeout(this.hideInfo, duration)\n  }\n\n  hideInfo () {\n    const newInfo = { ...this.getState().info, isHidden: true }\n    this.setState({\n      info: newInfo,\n    })\n    this.emit('info-hidden')\n  }\n\n  /**\n   * Passes messages to a function, provided in `opts.logger`.\n   * If `opts.logger: Uppy.debugLogger` or `opts.debug: true`, logs to the browser console.\n   *\n   * @param {string|object} message to log\n   * @param {string} [type] optional `error` or `warning`\n   */\n  log (message, type) {\n    const { logger } = this.opts\n    switch (type) {\n      case 'error': logger.error(message); break\n      case 'warning': logger.warn(message); break\n      default: logger.debug(message); break\n    }\n  }\n\n  /**\n   * Obsolete, event listeners are now added in the constructor.\n   */\n  run () {\n    this.log('Calling run() is no longer necessary.', 'warning')\n    return this\n  }\n\n  /**\n   * Restore an upload by its ID.\n   */\n  restore (uploadID) {\n    this.log(`Core: attempting to restore upload \"${uploadID}\"`)\n\n    if (!this.getState().currentUploads[uploadID]) {\n      this.removeUpload(uploadID)\n      return Promise.reject(new Error('Nonexistent upload'))\n    }\n\n    return this.runUpload(uploadID)\n  }\n\n  /**\n   * Create an upload for a bunch of files.\n   *\n   * @param {Array<string>} fileIDs File IDs to include in this upload.\n   * @returns {string} ID of this upload.\n   */\n  createUpload (fileIDs, opts = {}) {\n    // uppy.retryAll sets this to true — when retrying we want to ignore `allowNewUpload: false`\n    const { forceAllowNewUpload = false } = opts\n\n    const { allowNewUpload, currentUploads } = this.getState()\n    if (!allowNewUpload && !forceAllowNewUpload) {\n      throw new Error('Cannot create a new upload: already uploading.')\n    }\n\n    const uploadID = cuid()\n\n    this.emit('upload', {\n      id: uploadID,\n      fileIDs,\n    })\n\n    this.setState({\n      allowNewUpload: this.opts.allowMultipleUploads !== false,\n\n      currentUploads: {\n        ...currentUploads,\n        [uploadID]: {\n          fileIDs,\n          step: 0,\n          result: {},\n        },\n      },\n    })\n\n    return uploadID\n  }\n\n  getUpload (uploadID) {\n    const { currentUploads } = this.getState()\n\n    return currentUploads[uploadID]\n  }\n\n  /**\n   * Add data to an upload's result object.\n   *\n   * @param {string} uploadID The ID of the upload.\n   * @param {object} data Data properties to add to the result object.\n   */\n  addResultData (uploadID, data) {\n    if (!this.getUpload(uploadID)) {\n      this.log(`Not setting result for an upload that has been removed: ${uploadID}`)\n      return\n    }\n    const { currentUploads } = this.getState()\n    const currentUpload = { ...currentUploads[uploadID], result: { ...currentUploads[uploadID].result, ...data } }\n    this.setState({\n      currentUploads: { ...currentUploads, [uploadID]: currentUpload },\n    })\n  }\n\n  /**\n   * Remove an upload, eg. if it has been canceled or completed.\n   *\n   * @param {string} uploadID The ID of the upload.\n   */\n  removeUpload (uploadID) {\n    const currentUploads = { ...this.getState().currentUploads }\n    delete currentUploads[uploadID]\n\n    this.setState({\n      currentUploads,\n    })\n  }\n\n  /**\n   * Run an upload. This picks up where it left off in case the upload is being restored.\n   *\n   * @private\n   */\n  runUpload (uploadID) {\n    const uploadData = this.getState().currentUploads[uploadID]\n    const restoreStep = uploadData.step\n\n    const steps = [\n      ...this.preProcessors,\n      ...this.uploaders,\n      ...this.postProcessors,\n    ]\n    let lastStep = Promise.resolve()\n    steps.forEach((fn, step) => {\n      // Skip this step if we are restoring and have already completed this step before.\n      if (step < restoreStep) {\n        return\n      }\n\n      lastStep = lastStep.then(() => {\n        const { currentUploads } = this.getState()\n        const currentUpload = currentUploads[uploadID]\n        if (!currentUpload) {\n          return\n        }\n\n        const updatedUpload = {\n          ...currentUpload,\n          step,\n        }\n\n        this.setState({\n          currentUploads: {\n            ...currentUploads,\n            [uploadID]: updatedUpload,\n          },\n        })\n\n        // TODO give this the `updatedUpload` object as its only parameter maybe?\n        // Otherwise when more metadata may be added to the upload this would keep getting more parameters\n        // eslint-disable-next-line consistent-return\n        return fn(updatedUpload.fileIDs, uploadID)\n      }).then(() => {\n        return null\n      })\n    })\n\n    // Not returning the `catch`ed promise, because we still want to return a rejected\n    // promise from this method if the upload failed.\n    lastStep.catch((err) => {\n      this.emit('error', err)\n      this.removeUpload(uploadID)\n    })\n\n    return lastStep.then(() => {\n      // Set result data.\n      const { currentUploads } = this.getState()\n      const currentUpload = currentUploads[uploadID]\n      if (!currentUpload) {\n        return\n      }\n\n      // Mark postprocessing step as complete if necessary; this addresses a case where we might get\n      // stuck in the postprocessing UI while the upload is fully complete.\n      // If the postprocessing steps do not do any work, they may not emit postprocessing events at\n      // all, and never mark the postprocessing as complete. This is fine on its own but we\n      // introduced code in the @uppy/core upload-success handler to prepare postprocessing progress\n      // state if any postprocessors are registered. That is to avoid a \"flash of completed state\"\n      // before the postprocessing plugins can emit events.\n      //\n      // So, just in case an upload with postprocessing plugins *has* completed *without* emitting\n      // postprocessing completion, we do it instead.\n      currentUpload.fileIDs.forEach((fileID) => {\n        const file = this.getFile(fileID)\n        if (file && file.progress.postprocess) {\n          this.emit('postprocess-complete', file)\n        }\n      })\n\n      const files = currentUpload.fileIDs.map((fileID) => this.getFile(fileID))\n      const successful = files.filter((file) => !file.error)\n      const failed = files.filter((file) => file.error)\n      this.addResultData(uploadID, { successful, failed, uploadID })\n    }).then(() => {\n      // Emit completion events.\n      // This is in a separate function so that the `currentUploads` variable\n      // always refers to the latest state. In the handler right above it refers\n      // to an outdated object without the `.result` property.\n      const { currentUploads } = this.getState()\n      if (!currentUploads[uploadID]) {\n        return\n      }\n      const currentUpload = currentUploads[uploadID]\n      const { result } = currentUpload\n      this.emit('complete', result)\n\n      this.removeUpload(uploadID)\n\n      // eslint-disable-next-line consistent-return\n      return result\n    }).then((result) => {\n      if (result == null) {\n        this.log(`Not setting result for an upload that has been removed: ${uploadID}`)\n      }\n      return result\n    })\n  }\n\n  /**\n   * Start an upload for all the files that are not currently being uploaded.\n   *\n   * @returns {Promise}\n   */\n  upload () {\n    if (!this.plugins.uploader) {\n      this.log('No uploader type plugins are used', 'warning')\n    }\n\n    let { files } = this.getState()\n\n    const onBeforeUploadResult = this.opts.onBeforeUpload(files)\n\n    if (onBeforeUploadResult === false) {\n      return Promise.reject(new Error('Not starting the upload because onBeforeUpload returned false'))\n    }\n\n    if (onBeforeUploadResult && typeof onBeforeUploadResult === 'object') {\n      files = onBeforeUploadResult\n      // Updating files in state, because uploader plugins receive file IDs,\n      // and then fetch the actual file object from state\n      this.setState({\n        files,\n      })\n    }\n\n    return Promise.resolve()\n      .then(() => {\n        this.checkMinNumberOfFiles(files)\n        this.checkRequiredMetaFields(files)\n      })\n      .catch((err) => {\n        this.showOrLogErrorAndThrow(err)\n      })\n      .then(() => {\n        const { currentUploads } = this.getState()\n        // get a list of files that are currently assigned to uploads\n        const currentlyUploadingFiles = Object.keys(currentUploads)\n          .reduce((prev, curr) => prev.concat(currentUploads[curr].fileIDs), [])\n\n        const waitingFileIDs = []\n        Object.keys(files).forEach((fileID) => {\n          const file = this.getFile(fileID)\n          // if the file hasn't started uploading and hasn't already been assigned to an upload..\n          if ((!file.progress.uploadStarted) && (currentlyUploadingFiles.indexOf(fileID) === -1)) {\n            waitingFileIDs.push(file.id)\n          }\n        })\n\n        const uploadID = this.createUpload(waitingFileIDs)\n        return this.runUpload(uploadID)\n      })\n      .catch((err) => {\n        this.showOrLogErrorAndThrow(err, {\n          showInformer: false,\n        })\n      })\n  }\n}\n\nmodule.exports = function core (opts) {\n  return new Uppy(opts)\n}\n\n// Expose class constructor.\nmodule.exports.Uppy = Uppy\nmodule.exports.Plugin = Plugin\nmodule.exports.debugLogger = debugLogger\n"]}