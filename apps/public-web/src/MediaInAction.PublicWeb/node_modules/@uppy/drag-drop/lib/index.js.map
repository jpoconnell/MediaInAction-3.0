{"version":3,"sources":["index.js"],"names":["require","Plugin","Translator","toArray","isDragDropSupported","getDroppedFiles","h","module","exports","uppy","opts","type","id","title","defaultLocale","strings","dropHereOr","browse","defaultOpts","target","inputName","width","height","note","removeDragOverClassTimeout","i18nInit","onInputChange","bind","handleDragOver","handleDragLeave","handleDrop","addFiles","render","setOptions","newOpts","translator","locale","i18n","translate","i18nArray","translateArray","setPluginState","files","descriptors","map","file","source","name","data","meta","relativePath","err","log","event","value","onDrop","preventDefault","stopPropagation","clearTimeout","isDraggingOver","logDropError","error","dataTransfer","then","onDragOver","dropEffect","onDragLeave","setTimeout","renderHiddenFileInput","restrictions","ref","fileInputRef","maxNumberOfFiles","allowedFileTypes","renderArrowSvg","renderLabel","renderNote","dragDropClass","getPluginState","dragDropStyle","click","DragDrop","install","mount","uninstall","unmount","VERSION"],"mappings":"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","sourcesContent":["const { Plugin } = require('@uppy/core')\nconst Translator = require('@uppy/utils/lib/Translator')\nconst toArray = require('@uppy/utils/lib/toArray')\nconst isDragDropSupported = require('@uppy/utils/lib/isDragDropSupported')\nconst getDroppedFiles = require('@uppy/utils/lib/getDroppedFiles')\nconst { h } = require('preact')\n\n/**\n * Drag & Drop plugin\n *\n */\nmodule.exports = class DragDrop extends Plugin {\n  // eslint-disable-next-line global-require\n  static VERSION = require('../package.json').version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.type = 'acquirer'\n    this.id = this.opts.id || 'DragDrop'\n    this.title = 'Drag & Drop'\n\n    this.defaultLocale = {\n      strings: {\n        dropHereOr: 'Drop files here or %{browse}',\n        browse: 'browse',\n      },\n    }\n\n    // Default options\n    const defaultOpts = {\n      target: null,\n      inputName: 'files[]',\n      width: '100%',\n      height: '100%',\n      note: null,\n    }\n\n    // Merge default options with the ones set by user\n    this.opts = { ...defaultOpts, ...opts }\n\n    // Check for browser dragDrop support\n    this.isDragDropSupported = isDragDropSupported()\n    this.removeDragOverClassTimeout = null\n\n    this.i18nInit()\n\n    // Bind `this` to class methods\n    this.onInputChange = this.onInputChange.bind(this)\n    this.handleDragOver = this.handleDragOver.bind(this)\n    this.handleDragLeave = this.handleDragLeave.bind(this)\n    this.handleDrop = this.handleDrop.bind(this)\n    this.addFiles = this.addFiles.bind(this)\n    this.render = this.render.bind(this)\n  }\n\n  setOptions (newOpts) {\n    super.setOptions(newOpts)\n    this.i18nInit()\n  }\n\n  i18nInit () {\n    this.translator = new Translator([this.defaultLocale, this.uppy.locale, this.opts.locale])\n    this.i18n = this.translator.translate.bind(this.translator)\n    this.i18nArray = this.translator.translateArray.bind(this.translator)\n    this.setPluginState() // so that UI re-renders and we see the updated locale\n  }\n\n  addFiles (files) {\n    const descriptors = files.map((file) => ({\n      source: this.id,\n      name: file.name,\n      type: file.type,\n      data: file,\n      meta: {\n        // path of the file relative to the ancestor directory the user selected.\n        // e.g. 'docs/Old Prague/airbnb.pdf'\n        relativePath: file.relativePath || null,\n      },\n    }))\n\n    try {\n      this.uppy.addFiles(descriptors)\n    } catch (err) {\n      this.uppy.log(err)\n    }\n  }\n\n  onInputChange (event) {\n    this.uppy.log('[DragDrop] Files selected through input')\n    const files = toArray(event.target.files)\n    this.addFiles(files)\n\n    // We clear the input after a file is selected, because otherwise\n    // change event is not fired in Chrome and Safari when a file\n    // with the same name is selected.\n    // ___Why not use value=\"\" on <input/> instead?\n    //    Because if we use that method of clearing the input,\n    //    Chrome will not trigger change if we drop the same file twice (Issue #768).\n    // eslint-disable-next-line no-param-reassign\n    event.target.value = null\n  }\n\n  handleDrop (event) {\n    if (this.opts.onDrop) this.opts.onDrop(event)\n\n    event.preventDefault()\n    event.stopPropagation()\n    clearTimeout(this.removeDragOverClassTimeout)\n\n    // 2. Remove dragover class\n    this.setPluginState({ isDraggingOver: false })\n\n    // 3. Add all dropped files\n    this.uppy.log('[DragDrop] Files were dropped')\n    const logDropError = (error) => {\n      this.uppy.log(error, 'error')\n    }\n    getDroppedFiles(event.dataTransfer, { logDropError })\n      .then((files) => this.addFiles(files))\n  }\n\n  handleDragOver (event) {\n    if (this.opts.onDragOver) this.opts.onDragOver(event)\n    event.preventDefault()\n    event.stopPropagation()\n\n    // 1. Add a small (+) icon on drop\n    // (and prevent browsers from interpreting this as files being _moved_ into the browser\n    // https://github.com/transloadit/uppy/issues/1978)\n    //\n    // eslint-disable-next-line no-param-reassign\n    event.dataTransfer.dropEffect = 'copy'\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    this.setPluginState({ isDraggingOver: true })\n  }\n\n  handleDragLeave (event) {\n    if (this.opts.onDragLeave) this.opts.onDragLeave(event)\n    event.preventDefault()\n    event.stopPropagation()\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    // Timeout against flickering, this solution is taken from drag-drop library.\n    // Solution with 'pointer-events: none' didn't work across browsers.\n    this.removeDragOverClassTimeout = setTimeout(() => {\n      this.setPluginState({ isDraggingOver: false })\n    }, 50)\n  }\n\n  renderHiddenFileInput () {\n    const { restrictions } = this.uppy.opts\n    return (\n      <input\n        className=\"uppy-DragDrop-input\"\n        type=\"file\"\n        hidden\n        ref={(ref) => { this.fileInputRef = ref }}\n        name={this.opts.inputName}\n        multiple={restrictions.maxNumberOfFiles !== 1}\n        accept={restrictions.allowedFileTypes}\n        onChange={this.onInputChange}\n      />\n    )\n  }\n\n  static renderArrowSvg () {\n    return (\n      <svg aria-hidden=\"true\" focusable=\"false\" className=\"uppy-c-icon uppy-DragDrop-arrow\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\">\n        <path d=\"M11 10V0H5v10H2l6 6 6-6h-3zm0 0\" fillRule=\"evenodd\" />\n      </svg>\n    )\n  }\n\n  renderLabel () {\n    return (\n      <div className=\"uppy-DragDrop-label\">\n        {this.i18nArray('dropHereOr', {\n          browse: <span className=\"uppy-DragDrop-browse\">{this.i18n('browse')}</span>,\n        })}\n      </div>\n    )\n  }\n\n  renderNote () {\n    return (\n      <span className=\"uppy-DragDrop-note\">{this.opts.note}</span>\n    )\n  }\n\n  render () {\n    const dragDropClass = `uppy-Root\n      uppy-u-reset\n      uppy-DragDrop-container\n      ${this.isDragDropSupported ? 'uppy-DragDrop--isDragDropSupported' : ''}\n      ${this.getPluginState().isDraggingOver ? 'uppy-DragDrop--isDraggingOver' : ''}\n    `\n\n    const dragDropStyle = {\n      width: this.opts.width,\n      height: this.opts.height,\n    }\n\n    return (\n      <button\n        type=\"button\"\n        className={dragDropClass}\n        style={dragDropStyle}\n        onClick={() => this.fileInputRef.click()}\n        onDragOver={this.handleDragOver}\n        onDragLeave={this.handleDragLeave}\n        onDrop={this.handleDrop}\n      >\n        {this.renderHiddenFileInput()}\n        <div className=\"uppy-DragDrop-inner\">\n          {DragDrop.renderArrowSvg()}\n          {this.renderLabel()}\n          {this.renderNote()}\n        </div>\n      </button>\n    )\n  }\n\n  install () {\n    const { target } = this.opts\n\n    this.setPluginState({\n      isDraggingOver: false,\n    })\n\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall () {\n    this.unmount()\n  }\n}\n"]}